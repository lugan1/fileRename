name: Release Build & Deploy  # ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„, GitHub Actions UIì— í‘œì‹œë©ë‹ˆë‹¤.

on:                             # ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ íŠ¸ë¦¬ê±°í•  ì´ë²¤íŠ¸ ì •ì˜
  push:                        # git push ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì‹¤í–‰
    branches:                  # íŠ¹ì • ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œë§Œ ë™ì‘
      - main                   #   - main ë¸Œëœì¹˜
      - 'release/**'           #   - release/1.0, release/v2 ë“± íŒ¨í„´ ë§¤ì¹­ ë¸Œëœì¹˜

jobs:                          # ë³‘ë ¬ ë˜ëŠ” ìˆœì°¨ ì‹¤í–‰í•  ì‘ì—…(Job) ëª¨ìŒ
  build-release:               # Job ID, ë¡œê¹… ë° ì˜ì¡´ì„± ì°¸ì¡° ì‹œ ì‚¬ìš©
    runs-on: ubuntu-latest     # ì´ Jobì„ ëŒë¦´ ëŸ°ë„ˆ í™˜ê²½(OS) ì§€ì •

    permissions:               # GitHub API ì ‘ê·¼ ê¶Œí•œ ì„¤ì •
      contents: write          #   - ë¦¬í¬ì§€í† ë¦¬ ì½˜í…ì¸ (ì½”ë“œ, ë¦´ë¦¬ìŠ¤ ë“±)ì— ì“°ê¸° ê¶Œí•œ ë¶€ì—¬

      #ueses: ë¯¸ë¦¬ ì •í•´ì§„ ì•¡ì…˜ì„ ì‚¬ìš©í•œë‹¤. ë§ˆì¼“ í”Œë ˆì´ìŠ¤ì—ì„œ ê³ ë¥¼ìˆ˜ ìˆë‹¤.
      #run: ë‹¨ì¼ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤.

    steps:                     # Job ë‚´ì—ì„œ ìˆœì°¨ ì‹¤í–‰í•  ë‹¨ê³„ ì •ì˜
      - name: ğŸ”„ Checkout     # ë‹¨ê³„ ì´ë¦„, UIì— í‘œì‹œ
        uses: actions/checkout@v3  # í•´ë‹¹ git ë¸Œëœì¹˜ì— ì²´í¬ì•„ì›ƒí•˜ë©° ë ˆí¬ì§€í† ë¦¬ë¥¼ í´ë¡ ë°›ëŠ”ë‹¤.

      - name: â˜• Set up JDK 19    # ë‹¨ê³„ ì´ë¦„
        uses: actions/setup-java@v3  # ì•¡ì…˜ ì‚¬ìš©: JDK ì„¤ì¹˜, gradle ì‚¬ìš©ì„ ìœ„í•´ í•„ìš”
        with:
          java-version: '19'         # ì„¤ì¹˜í•  Java ë²„ì „
          distribution: 'temurin'    # AdoptOpenJDK ê¸°ë°˜ ë°°í¬íŒ


        # ë™ì‘ ì„¤ëª…:
        # 1) ì‹¤í–‰ ì‹œ, í•´ë‹¹ keyë¡œ ì €ì¥ëœ ìºì‹œê°€ ìˆìœ¼ë©´ GitHub ìºì‹œ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë‹¤ìš´ë¡œë“œí•´ ë‹¤ìŒ ê²½ë¡œì— ë³µì›
        # 2) ìºì‹œê°€ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœë¡œ ë¹Œë“œ ì§„í–‰ í›„, Job ì¢…ë£Œ ì‹œ ìœ„ ê²½ë¡œ ë‚´ìš©ì„ ìŠ¤í† ë¦¬ì§€ì— ì—…ë¡œë“œ
      - name: ğŸ§± Cache Gradle     # ë‹¨ê³„ ì´ë¦„
        uses: actions/cache@v3      # ì•¡ì…˜ ì‚¬ìš©: ìºì‹œ ê´€ë¦¬
        with:
          path: |                   # ìºì‹œí•  íŒŒì¼/ë””ë ‰í„°ë¦¬ ê²½ë¡œ
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}  # ìºì‹œ í‚¤
          restore-keys: |
            ${{ runner.os }}-gradle    # í‚¤ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ í‚¤

      - name: âœ… Grant execute permission to gradlew  # ë‹¨ê³„ ì´ë¦„
        run: chmod +x ./gradlew      # ì…¸ ëª…ë ¹ ì‹¤í–‰: gradlew ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬

      - name: âš™ï¸ Run Gradle releaseAll  # ë‹¨ê³„ ì´ë¦„
        run: ./gradlew releaseAll    # ì…¸ ëª…ë ¹ ì‹¤í–‰: Gradle íƒœìŠ¤í¬ ì‹¤í–‰

        env:                         # ì´ ìŠ¤í…ì—ì„œ ì‚¬ìš©í•  í™˜ê²½ë³€ìˆ˜ ì„¤ì •
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # GitHub ìë™ ì œê³µ í† í° (ê¶Œí•œ: contents.write)
